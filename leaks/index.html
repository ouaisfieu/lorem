
<!DOCTYPE html>
<html lang="la">
<head>
  <meta charset="UTF-8" />
  <title>LOREM 3 – Roman Graphicus Interactivus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050509;
      --bg-panel: #0c0c12;
      --bg-panel-alt: #12121b;
      --accent: #f5e87a;
      --accent-soft: #f5e87a22;
      --accent-strong: #ffdd55;
      --text-main: #f7f7f7;
      --text-muted: #8587a0;
      --edge: #0b0b10;
      --danger: #ff4b6a;
      --shadow-soft: 0 0 40px rgba(0, 0, 0, 0.8);
      --radius-xl: 24px;
      --transition-fast: 0.16s ease-out;
      --transition-med: 0.25s ease-out;
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      background: radial-gradient(circle at top, #1a1a24 0, #050509 60%);
      color: var(--text-main);
      font-family: var(--font-main);
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .frame {
      width: 100%;
      max-width: 1200px;
      height: min(720px, 100vh - 32px);
      background: linear-gradient(135deg, #050509, #030308);
      border-radius: 28px;
      box-shadow:
        0 0 0 1px #ffffff0a,
        0 30px 80px rgba(0,0,0,0.9);
      display: grid;
      grid-template-columns: 220px minmax(0, 1.4fr) 260px;
      overflow: hidden;
      position: relative;
      isolation: isolate;
    }

    /* Vignette / glow */
    .frame::before {
      content: "";
      position: absolute;
      inset: -40px;
      background:
        radial-gradient(circle at 15% 0%, #f5e87a06 0, transparent 55%),
        radial-gradient(circle at 80% 100%, #ff4b6a12 0, transparent 60%);
      mix-blend-mode: screen;
      opacity: 0.9;
      pointer-events: none;
    }

    .frame::after {
      content: "";
      position: absolute;
      inset: 0;
      box-shadow: inset 0 0 120px rgba(0,0,0,0.85);
      pointer-events: none;
    }

    /* Left rail: title, timeline, stats */

    .rail {
      position: relative;
      z-index: 1;
      background: radial-gradient(circle at top, #171724, #050509);
      border-right: 1px solid #ffffff14;
      padding: 18px 16px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .logo-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .logo-main {
      font-size: 28px;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: var(--accent-strong);
      text-shadow: 0 0 18px rgba(245,232,122,0.55);
    }

    .logo-sub {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: var(--text-muted);
      opacity: 0.9;
    }

    .divider {
      height: 1px;
      width: 100%;
      background: linear-gradient(to right, transparent, #ffffff33, transparent);
      margin: 2px 0 4px;
    }

    .rail-meta {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      font-size: 11px;
    }

    .meta-pill {
      background: #11111b;
      border-radius: 16px;
      padding: 8px 9px;
      border: 1px solid #ffffff12;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .meta-label {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
      font-size: 9px;
    }

    .meta-value {
      color: var(--accent);
      font-weight: 600;
      font-size: 11px;
      white-space: nowrap;
    }

    .timeline {
      flex: 1;
      margin-top: 2px;
      padding-right: 4px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #444 #111;
      font-size: 11px;
    }

    .timeline::-webkit-scrollbar {
      width: 4px;
    }
    .timeline::-webkit-scrollbar-track {
      background: transparent;
    }
    .timeline::-webkit-scrollbar-thumb {
      background: #444;
      border-radius: 999px;
    }

    .timeline-item {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 8px;
      align-items: center;
      cursor: pointer;
      position: relative;
      padding: 4px 6px;
      border-radius: 999px;
      transition: background var(--transition-fast), transform var(--transition-fast);
    }

    .timeline-item:hover {
      background: #ffffff08;
      transform: translateX(2px);
    }

    .timeline-item.active {
      background: var(--accent-soft);
    }

    .timeline-node {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid #ffffff33;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      flex-shrink: 0;
    }

    .timeline-node::before {
      content: "";
      position: absolute;
      width: 3px;
      height: 22px;
      background: linear-gradient(to bottom, #ffffff2b, transparent);
      top: -22px;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0.8;
    }

    .timeline-item:first-child .timeline-node::before {
      display: none;
    }

    .timeline-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #ffffff33;
    }

    .timeline-item.active .timeline-dot {
      background: var(--accent);
      box-shadow: 0 0 12px rgba(245,232,122,0.7);
    }

    .timeline-label-main {
      text-transform: uppercase;
      letter-spacing: 0.17em;
      color: var(--text-muted);
    }

    .timeline-label-sub {
      color: #ffffffaa;
      font-size: 10px;
    }

    .rail-footer {
      font-size: 9px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.16em;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .rail-led {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, var(--accent-strong), #a97c0f);
      box-shadow: 0 0 12px rgba(245,232,122,0.9);
    }

    /* Center: main comic panel */

    .stage {
      position: relative;
      z-index: 1;
      padding: 18px 18px 18px 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: radial-gradient(circle at 20% 0%, #1d1d2a, #050509 65%);
    }

    .stage-topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
    }

    .stage-topbar span:nth-child(2) {
      color: #ffffffb8;
    }

    .panel {
      flex: 1;
      border-radius: var(--radius-xl);
      background: radial-gradient(circle at 15% 0%, #45475f35, transparent 55%), #050509;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 0;
      overflow: hidden;
      border: 1px solid #ffffff14;
      box-shadow: var(--shadow-soft);
      position: relative;
    }

    /* Image side */

    .panel-visual {
      position: relative;
      padding: 18px 16px;
      background: radial-gradient(circle at 0 0, #f5e87a11, transparent 55%), #070712;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .panel-tagbar {
      display: flex;
      gap: 8px;
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.21em;
    }

    .panel-tag {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #ffffff22;
      color: var(--text-muted);
      background: #05050999;
      backdrop-filter: blur(6px);
    }

    .panel-tag--accent {
      border-color: var(--accent);
      color: var(--accent);
      background: #f5e87a11;
    }

    .noir-scene {
      position: relative;
      flex: 1;
      margin-top: 4px;
      border-radius: 18px;
      background:
        linear-gradient(to top, #020208, #05050b 38%, #11111d 100%);
      overflow: hidden;
      border: 1px solid #ffffff16;
    }

    /* Stylised "image": city, rain, silhouette */

    .noir-scene::before,
    .noir-scene::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    /* Rain */
    .noir-scene::before {
      background-image:
        repeating-linear-gradient(
          120deg,
          rgba(255,255,255,0.05) 0px,
          rgba(255,255,255,0.08) 1px,
          transparent 1px,
          transparent 8px
        );
      mix-blend-mode: screen;
      opacity: 0.5;
      animation: rain 900ms linear infinite;
    }

    @keyframes rain {
      from { transform: translate3d(0, -10px, 0); }
      to   { transform: translate3d(-4px, 10px, 0); }
    }

    /* Vignette */
    .noir-scene::after {
      box-shadow: inset 0 0 80px rgba(0,0,0,0.9);
    }

    /* City silhouette */
    .cityline {
      position: absolute;
      inset: auto 0 0;
      height: 50%;
      display: flex;
      align-items: flex-end;
      gap: 4px;
      padding: 0 12px 6px;
    }

    .building {
      flex: 1;
      border-radius: 3px 3px 0 0;
      background: linear-gradient(to top, #030307, #121222);
      position: relative;
      overflow: hidden;
    }

    .building:nth-child(2n) {
      height: 85%;
    }

    .building:nth-child(2n+1) {
      height: 65%;
    }

    .building::before {
      content: "";
      position: absolute;
      inset: 4px 6px;
      background-image:
        radial-gradient(circle, #f5e87a55 0, transparent 55%);
      background-size: 6px 8px;
      background-repeat: repeat;
      opacity: 0.4;
      mix-blend-mode: screen;
    }

    .moon {
      position: absolute;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      right: 16px;
      top: 18px;
      background:
        radial-gradient(circle at 30% 25%, #ffffff, #f5e87a 45%, #f5e87a00 70%);
      box-shadow: 0 0 40px rgba(245,232,122,0.85);
      opacity: 0.95;
    }

    .moon::after {
      content: "";
      position: absolute;
      inset: 8px 22px 18px -6px;
      border-radius: 50%;
      background: radial-gradient(circle at 20% 20%, #000000aa, transparent 65%);
      transform: rotate(-18deg);
    }

    .silhouette {
      position: absolute;
      bottom: 0;
      left: 18%;
      width: 90px;
      height: 160px;
      filter: drop-shadow(0 0 16px #000);
    }

    .silhouette-body {
      position: absolute;
      inset: auto 0 0;
      height: 70%;
      margin: 0 auto;
      width: 40px;
      border-radius: 10px 10px 0 0;
      background: linear-gradient(to top, #020206, #05050b);
    }

    .silhouette-coat {
      position: absolute;
      inset: auto 0 0;
      margin: 0 auto;
      width: 76px;
      height: 110px;
      border-radius: 14px 14px 0 0;
      background: linear-gradient(to top, #000000, #05050f);
      clip-path: polygon(10% 0, 90% 0, 100% 60%, 80% 100%, 20% 100%, 0 60%);
    }

    .silhouette-hat {
      position: absolute;
      top: 16px;
      left: 50%;
      width: 72px;
      height: 26px;
      transform: translateX(-50%);
    }

    .silhouette-hat-brim {
      position: absolute;
      inset: auto 0 0;
      margin: 0 auto;
      width: 72px;
      height: 7px;
      border-radius: 999px;
      background: #000;
    }

    .silhouette-hat-crown {
      position: absolute;
      inset: auto 0 7px;
      margin: 0 auto;
      width: 34px;
      height: 20px;
      border-radius: 8px 8px 4px 4px;
      background: linear-gradient(to top, #000000, #070713);
    }

    .scene-overlay-caption {
      position: absolute;
      left: 12px;
      bottom: 12px;
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: #f7f7f7aa;
      padding: 4px 8px;
      border-radius: 999px;
      background: #050509aa;
      border: 1px solid #ffffff33;
      backdrop-filter: blur(4px);
    }

    .panel-caption {
      margin-top: 8px;
      font-size: 10px;
      color: var(--text-muted);
      max-width: 90%;
    }

    /* Narrative side */

    .panel-story {
      position: relative;
      padding: 18px 18px 18px 14px;
      background: radial-gradient(circle at 100% 100%, #ff4b6a12, #050509 60%);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .chapter-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.26em;
      color: var(--text-muted);
    }

    .chapter-title {
      font-size: 20px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #ffffffee;
    }

    .chapter-divider {
      width: 38px;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(to right, var(--accent), transparent);
      margin-top: 6px;
    }

    .chapter-body {
      margin-top: 10px;
      padding-right: 4px;
      flex: 1;
      overflow-y: auto;
      scrollbar-width: none;
      font-size: 13px;
      line-height: 1.6;
      color: #e8e8f5;
    }

    .chapter-body::-webkit-scrollbar {
      display: none;
    }

    .chapter-body p + p {
      margin-top: 10px;
    }

    .choice-grid {
      margin-top: 14px;
      padding-top: 10px;
      border-top: 1px solid #ffffff16;
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 8px;
    }

    .choice-btn {
      position: relative;
      border-radius: 999px;
      border: 1px solid #ffffff26;
      background: #050509aa;
      color: #f7f7f7;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 9px 11px 9px 24px;
      text-align: left;
      cursor: pointer;
      overflow: hidden;
      transition:
        border-color var(--transition-fast),
        background var(--transition-fast),
        transform var(--transition-fast),
        box-shadow var(--transition-fast);
    }

    .choice-btn::before {
      content: "";
      position: absolute;
      left: 9px;
      top: 50%;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      border: 1px solid #ffffff55;
      transform: translateY(-50%);
    }

    .choice-btn::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, #f5e87a22, transparent 50%);
      opacity: 0;
      transition: opacity var(--transition-fast);
      pointer-events: none;
    }

    .choice-btn:hover {
      border-color: var(--accent);
      background: #0b0b16;
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.6);
    }

    .choice-btn:hover::after {
      opacity: 1;
    }

    .choice-btn.choice-danger {
      border-color: #ff4b6a99;
      background: #15070d;
    }

    .choice-btn.choice-danger:hover {
      background: #220813;
      box-shadow: 0 0 22px rgba(255,75,106,0.3);
    }

    .chapter-foot {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 10px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.18em;
    }

    .chapter-foot span:nth-child(2) {
      color: #ffffffa8;
    }

    /* Right: hero profile & interaction */

    .side {
      position: relative;
      z-index: 1;
      background: radial-gradient(circle at 0 0, #f5e87a0a, transparent 55%), #050509;
      border-left: 1px solid #ffffff14;
      padding: 18px 16px 18px 14px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .side-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
    }

    .side-header span:nth-child(2) {
      color: var(--accent);
    }

    .avatar-wrap {
      position: relative;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .avatar-inner {
      position: relative;
      width: 80px;
      height: 80px;
      border-radius: 999px;
      padding: 3px;
      background: conic-gradient(from 210deg, #f5e87a, #ff4b6a, #773cff, #f5e87a);
      box-shadow: 0 0 25px rgba(0,0,0,0.9);
    }

    .avatar-inner::after {
      content: "";
      position: absolute;
      inset: 8px;
      border-radius: inherit;
      background: radial-gradient(circle at 30% 0, #ffffff18, transparent 55%);
      mix-blend-mode: screen;
    }

    .avatar-photo {
      position: relative;
      inset: 0;
      border-radius: inherit;
      background:
        linear-gradient(135deg, #050509, #0d0d19);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .avatar-photo label {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #ffffffaa;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px dashed #ffffff44;
      cursor: pointer;
      background: #050509dd;
      backdrop-filter: blur(6px);
    }

    .avatar-photo input {
      display: none;
    }

    .avatar-img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
      display: none;
    }

    .avatar-textblock {
      flex: 1;
      font-size: 11px;
      color: var(--text-muted);
    }

    .avatar-textblock h3 {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #ffffffd1;
      margin-bottom: 4px;
    }

    .avatar-tags {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .avatar-tag {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #ffffff24;
      color: #ffffffb0;
    }

    .hero-form {
      margin-top: 4px;
      font-size: 10px;
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 8px 8px;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .field-label {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
      font-size: 9px;
    }

    .field-input,
    .field-select,
    .field-textarea {
      border-radius: 999px;
      border: 1px solid #ffffff20;
      background: #0b0b14;
      color: #f7f7f7;
      font-size: 11px;
      padding: 5px 9px;
      outline: none;
      transition:
        border-color var(--transition-fast),
        box-shadow var(--transition-fast),
        background var(--transition-fast);
    }

    .field-textarea {
      border-radius: 12px;
      min-height: 52px;
      resize: vertical;
      font-family: var(--font-main);
      font-size: 11px;
      line-height: 1.4;
    }

    .field-input:focus,
    .field-select:focus,
    .field-textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px #f5e87a33;
      background: #11111d;
    }

    .field-select {
      appearance: none;
      background-image:
        linear-gradient(45deg, transparent 50%, #f5e87a 50%),
        linear-gradient(135deg, #f5e87a 50%, transparent 50%);
      background-position:
        calc(100% - 11px) 10px,
        calc(100% - 7px) 10px;
      background-size: 4px 4px, 4px 4px;
      background-repeat: no-repeat;
      padding-right: 18px;
    }

    .field-full {
      grid-column: 1 / -1;
    }

    .export-bar {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid #ffffff16;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 10px;
      align-items: center;
    }

    .export-btn {
      border-radius: 999px;
      border: 1px solid #ffffff2a;
      padding: 6px 10px;
      background: #050509cc;
      color: #f7f7f7;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-size: 9px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition:
        border-color var(--transition-fast),
        background var(--transition-fast),
        transform var(--transition-fast),
        box-shadow var(--transition-fast);
    }

    .export-btn span {
      font-size: 12px;
    }

    .export-btn:hover {
      border-color: var(--accent);
      background: #0c0c16;
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.75);
    }

    .export-hint {
      flex: 1;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-size: 8px;
    }

    .side-footnote {
      margin-top: 4px;
      font-size: 9px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .side-footnote .accent {
      color: var(--accent);
    }

    /* Responsive */

    @media (max-width: 980px) {
      .frame {
        grid-template-columns: 190px minmax(0, 1.2fr);
        grid-template-rows: auto auto;
        height: auto;
        max-height: none;
      }
      .side {
        grid-column: 1 / -1;
        border-left: none;
        border-top: 1px solid #ffffff18;
        flex-direction: column;
        height: auto;
      }
    }

    @media (max-width: 720px) {
      body {
        padding: 10px;
      }
      .frame {
        grid-template-columns: minmax(0, 1fr);
        grid-template-rows: auto auto auto;
      }
      .rail {
        border-right: none;
        border-bottom: 1px solid #ffffff18;
      }
      .panel {
        grid-template-columns: 1fr;
      }
      .panel-visual {
        order: 2;
      }
      .panel-story {
        order: 1;
      }
    }

    @media (max-width: 520px) {
      .logo-main {
        font-size: 22px;
      }
      .hero-form {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="frame" id="lorem3">
    <!-- LEFT RAIL -->
    <aside class="rail">
      <div class="logo-block">
        <div class="logo-main">LOREM 3</div>
        <div class="logo-sub">roman graphicus interactivus</div>
      </div>
      <div class="divider"></div>
      <div class="rail-meta">
        <div class="meta-pill">
          <div class="meta-label">modus</div>
          <div class="meta-value" id="metaMode">noctis</div>
        </div>
        <div class="meta-pill">
          <div class="meta-label">status</div>
          <div class="meta-value" id="metaStatus">incipit</div>
        </div>
        <div class="meta-pill">
          <div class="meta-label">scena</div>
          <div class="meta-value" id="metaScene">01</div>
        </div>
        <div class="meta-pill">
          <div class="meta-label">iter</div>
          <div class="meta-value" id="metaPath">000</div>
        </div>
      </div>

      <div class="timeline" id="timeline">
        <!-- items generated by JS -->
      </div>

      <div class="rail-footer">
        <span>lorem ipsum</span>
        <span class="rail-led"></span>
      </div>
    </aside>

    <!-- CENTER STAGE -->
    <main class="stage">
      <div class="stage-topbar">
        <span>noir / lumen</span>
        <span id="topSceneTitle">lorem ipsum noctis</span>
        <span id="topSceneCode">scena · 01</span>
      </div>

      <section class="panel" aria-label="scena principalis">
        <!-- VISUAL -->
        <div class="panel-visual">
          <div class="panel-tagbar">
            <div class="panel-tag panel-tag--accent">noctis pluvia</div>
            <div class="panel-tag">urbe muta</div>
          </div>

          <div class="noir-scene">
            <div class="moon"></div>

            <div class="silhouette">
              <div class="silhouette-body"></div>
              <div class="silhouette-coat"></div>
              <div class="silhouette-hat">
                <div class="silhouette-hat-brim"></div>
                <div class="silhouette-hat-crown"></div>
              </div>
            </div>

            <div class="cityline">
              <div class="building"></div>
              <div class="building"></div>
              <div class="building"></div>
              <div class="building"></div>
              <div class="building"></div>
            </div>

            <div class="scene-overlay-caption" id="sceneOverlay">
              lorem ipsum pluvia
            </div>
          </div>

          <p class="panel-caption" id="panelCaption">
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc ultricies, ipsum nec mattis
            vehicula, lacus lorem bibendum neque, vitae dictum ipsum odio sit amet lorem.
          </p>
        </div>

        <!-- STORY -->
        <div class="panel-story">
          <div>
            <div class="chapter-label" id="chapterLabel">caput primum</div>
            <div class="chapter-title" id="chapterTitle">lorem ipsum tenebris</div>
            <div class="chapter-divider"></div>
          </div>

          <div class="chapter-body" id="chapterBody">
            <!-- paragraphs injected by JS -->
          </div>

          <div class="choice-grid" id="choiceGrid">
            <!-- choices injected by JS -->
          </div>

          <div class="chapter-foot">
            <span id="chapterRule">&lt;vide&gt;vide&lt;/vide&gt;</span>
            <span id="chapterProgress">ipsum · 000</span>
          </div>
        </div>
      </section>
    </main>

    <!-- RIGHT SIDE: HERO SHEET + EXPORT -->
    <aside class="side">
      <div class="side-header">
        <span>persona</span>
        <span>ipsum</span>
      </div>

      <div class="avatar-wrap">
        <div class="avatar-inner">
          <div class="avatar-photo">
            <img id="avatarImg" class="avatar-img" alt="imago personae">
            <label for="avatarInput" id="avatarLabel">lorem ipsum imago</label>
            <input id="avatarInput" type="file" accept="image/*">
          </div>
        </div>
        <div class="avatar-textblock">
          <h3 id="avatarNamePreview">lorem ipsum</h3>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent tempus ipsum vitae
            ipsum auctor, eu porttitor lorem molestie.
          </p>
          <div class="avatar-tags" id="avatarTags">
            <span class="avatar-tag">noctis</span>
            <span class="avatar-tag">umbra</span>
            <span class="avatar-tag">silentium</span>
          </div>
        </div>
      </div>

      <form class="hero-form" id="heroForm" autocomplete="off">
        <div class="field-group">
          <label class="field-label" for="heroName">nomen</label>
          <input id="heroName" class="field-input" type="text" placeholder="lorem ipsum" />
        </div>
        <div class="field-group">
          <label class="field-label" for="heroRole">persona</label>
          <select id="heroRole" class="field-select">
            <option value="umbra">umbra</option>
            <option value="lumen">lumen</option>
            <option value="silens">silens</option>
            <option value="ignis">ignis</option>
          </select>
        </div>
        <div class="field-group">
          <label class="field-label" for="heroTrait">signum</label>
          <input id="heroTrait" class="field-input" type="text" placeholder="dolor sit" />
        </div>
        <div class="field-group">
          <label class="field-label" for="heroCode">codex</label>
          <input id="heroCode" class="field-input" type="text" placeholder="ipsum-000" />
        </div>
        <div class="field-group field-full">
          <label class="field-label" for="heroNotes">lorem</label>
          <textarea id="heroNotes" class="field-textarea" placeholder="ipsum dolor sit amet..."></textarea>
        </div>
      </form>

      <div class="export-bar">
        <button type="button" class="export-btn" id="exportJsonBtn">
          <span>⬤</span> lorem json
        </button>
        <button type="button" class="export-btn" id="exportTxtBtn">
          <span>⬤</span> ipsum txt
        </button>
        <div class="export-hint">
          lorem ipsum &lt;ipsum&gt;ipsum&lt;/ipsum&gt;
        </div>
      </div>

      <div class="side-footnote">
        <span class="accent">regula</span> · lorem ipsum &lt;vide&gt;vide&lt;/vide&gt;
      </div>
    </aside>
  </div>

  <script>
    // --- STORY GRAPH (all lorem ipsum) --------------------------------------

    const SCENES = [
      {
        id: "s01",
        code: "01",
        timelineLabel: "noctis",
        timelineSub: "lorem ipsum",
        chapterLabel: "caput primum",
        chapterTitle: "lorem ipsum tenebris",
        overlay: "noctis pluvia",
        caption:
          "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer at ipsum sed lorem aliquet feugiat.",
        paragraphs: [
          "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur sit amet lorem vitae ipsum sagittis imperdiet. Integer tempus lorem quis ipsum porta, eget consectetur lacus blandit.",
          "Suspendisse potenti. Praesent tempus, orci ac volutpat bibendum, ipsum urna tincidunt lorem, nec gravida ipsum lorem sed neque. In hac habitasse platea dictumst.",
          "Nunc laoreet ipsum at lorem tincidunt, vel rutrum ipsum aliquet. Donec et lorem sed ipsum dapibus dignissim in eget eros."
        ],
        choices: [
          { text: "lorem ipsum ad vicum", target: "s02", danger: false },
          { text: "ipsum tenebris manere", target: "s03", danger: false }
        ]
      },
      {
        id: "s02",
        code: "02",
        timelineLabel: "vicus",
        timelineSub: "dolor sit",
        chapterLabel: "caput secundum",
        chapterTitle: "vicus vacuus",
        overlay: "vicus obscurus",
        caption:
          "Morbi luctus ipsum nec lorem congue, vitae blandit ipsum consectetur. Cras tempor lorem sit amet ipsum aliquet.",
        paragraphs: [
          "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus rutrum lorem ac ipsum laoreet, sed ultrices lorem posuere.",
          "Maecenas dictum lorem a ipsum laoreet, quis bibendum ipsum efficitur. Cras sit amet ipsum id lorem lobortis ultricies.",
          "Phasellus luctus lorem nec ipsum auctor, a fermentum lorem euismod. Vivamus consectetur lorem vitae ipsum pulvinar, ut feugiat lorem pharetra."
        ],
        choices: [
          { text: "lorem ad flumen", target: "s04", danger: false },
          { text: "ipsum retro in umbra", target: "s01", danger: false }
        ]
      },
      {
        id: "s03",
        code: "03",
        timelineLabel: "umbra",
        timelineSub: "amet dolor",
        chapterLabel: "caput tertium",
        chapterTitle: "umbra tacita",
        overlay: "umbra vigilans",
        caption:
          "Nullam lorem ipsum, porta at lorem eget, feugiat sagittis ipsum. Sed tincidunt lorem nec ipsum ultrices dictum.",
        paragraphs: [
          "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed vitae lorem at ipsum dictum congue. Nulla facilisi.",
          "Etiam elementum lorem ipsum, non elementum lorem interdum a. Nam quis lorem ac ipsum convallis dapibus.",
          "Sed bibendum lorem non ipsum vestibulum, vel pretium ipsum mollis. Mauris vitae lorem sit amet ipsum sodales iaculis."
        ],
        choices: [
          { text: "lorem ad portam clausam", target: "s05", danger: true },
          { text: "ipsum sequi umbram", target: "s04", danger: false }
        ]
      },
      {
        id: "s04",
        code: "04",
        timelineLabel: "flumen",
        timelineSub: "sit amet",
        chapterLabel: "caput quartum",
        chapterTitle: "flumen mutum",
        overlay: "flumen nigrum",
        caption:
          "Donec lorem ipsum, tempor vel lorem sed, feugiat convallis ipsum. Integer maximus lorem id ipsum malesuada pretium.",
        paragraphs: [
          "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec vulputate lorem et ipsum porta, in volutpat lorem feugiat.",
          "Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Donec tincidunt lorem eget ipsum pulvinar bibendum.",
          "Aliquam erat volutpat. Vivamus porta lorem non ipsum scelerisque, id aliquet lorem congue."
        ],
        choices: [
          { text: "lorem trans flumen", target: "s06", danger: true },
          { text: "ipsum retro ad vicum", target: "s02", danger: false }
        ]
      },
      {
        id: "s05",
        code: "05",
        timelineLabel: "porta",
        timelineSub: "consectetur",
        chapterLabel: "caput quintum",
        chapterTitle: "porta clausa",
        overlay: "silentium grave",
        caption:
          "Curabitur lorem ipsum, malesuada in lorem vel, sodales tempus ipsum. Nunc rutrum lorem eget ipsum ultrices feugiat.",
        paragraphs: [
          "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis bibendum lorem at ipsum posuere, vel condimentum lorem convallis.",
          "Interdum et malesuada fames ac ante ipsum primis in faucibus. Cras lacinia lorem in ipsum hendrerit, eget luctus lorem dapibus.",
          "Morbi feugiat lorem eget ipsum fermentum, ut sagittis lorem faucibus."
        ],
        choices: [
          { text: "lorem pulsare iterum", target: "s05", danger: true },
          { text: "ipsum in umbra evanescere", target: "s06", danger: true }
        ]
      },
      {
        id: "s06",
        code: "06",
        timelineLabel: "finis",
        timelineSub: "ipsum",
        chapterLabel: "caput ultimum",
        chapterTitle: "lorem ipsum finis",
        overlay: "noctis ultima",
        caption:
          "Integer lorem ipsum, cursus vitae lorem vitae, faucibus convallis ipsum. Vivamus suscipit lorem a ipsum porttitor pharetra.",
        paragraphs: [
          "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin vestibulum lorem at ipsum aliquet, sed aliquet lorem mattis.",
          "Sed eu lorem eu ipsum rhoncus pulvinar. Donec tristique lorem at ipsum condimentum, non auctor lorem dictum.",
          "Curabitur lorem ipsum, tincidunt non ipsum id, luctus dapibus lorem. Donec lorem ipsum, tempor quis ipsum non, congue bibendum lorem."
        ],
        choices: [
          { text: "lorem iterum ab initio", target: "s01", danger: false },
          { text: "ipsum manere in tenebris", target: "s06", danger: true }
        ]
      }
    ];

    let currentSceneId = "s01";
    let visitedCount = 0;

    const timelineEl = document.getElementById("timeline");
    const topSceneTitleEl = document.getElementById("topSceneTitle");
    const topSceneCodeEl = document.getElementById("topSceneCode");
    const metaSceneEl = document.getElementById("metaScene");
    const metaPathEl = document.getElementById("metaPath");
    const sceneOverlayEl = document.getElementById("sceneOverlay");
    const panelCaptionEl = document.getElementById("panelCaption");
    const chapterLabelEl = document.getElementById("chapterLabel");
    const chapterTitleEl = document.getElementById("chapterTitle");
    const chapterBodyEl = document.getElementById("chapterBody");
    const choiceGridEl = document.getElementById("choiceGrid");
    const chapterProgressEl = document.getElementById("chapterProgress");

    function getScene(id) {
      return SCENES.find((s) => s.id === id) || SCENES[0];
    }

    function buildTimeline() {
      timelineEl.innerHTML = "";
      SCENES.forEach((scene) => {
        const item = document.createElement("button");
        item.type = "button";
        item.className = "timeline-item";
        item.dataset.target = scene.id;

        const node = document.createElement("div");
        node.className = "timeline-node";
        const dot = document.createElement("div");
        dot.className = "timeline-dot";
        node.appendChild(dot);

        const labels = document.createElement("div");
        labels.className = "timeline-labels";
        const main = document.createElement("div");
        main.className = "timeline-label-main";
        main.textContent = scene.timelineLabel;
        const sub = document.createElement("div");
        sub.className = "timeline-label-sub";
        sub.textContent = scene.timelineSub;

        labels.appendChild(main);
        labels.appendChild(sub);

        item.appendChild(node);
        item.appendChild(labels);

        item.addEventListener("click", () => {
          goToScene(scene.id);
        });

        timelineEl.appendChild(item);
      });
    }

    function updateTimelineActive(id) {
      Array.from(timelineEl.children).forEach((item) => {
        const isActive = item.dataset.target === id;
        item.classList.toggle("active", isActive);
      });
    }

    function renderScene(scene) {
      topSceneTitleEl.textContent = scene.chapterTitle;
      topSceneCodeEl.textContent = `scena · ${scene.code}`;
      metaSceneEl.textContent = scene.code.padStart(2, "0");
      sceneOverlayEl.textContent = scene.overlay;
      panelCaptionEl.textContent = scene.caption;
      chapterLabelEl.textContent = scene.chapterLabel;
      chapterTitleEl.textContent = scene.chapterTitle;

      chapterBodyEl.innerHTML = "";
      scene.paragraphs.forEach((p) => {
        const para = document.createElement("p");
        para.textContent = p;
        chapterBodyEl.appendChild(para);
      });

      choiceGridEl.innerHTML = "";
      scene.choices.forEach((choice) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "choice-btn";
        if (choice.danger) btn.classList.add("choice-danger");
        btn.textContent = choice.text;
        btn.addEventListener("click", () => {
          goToScene(choice.target);
        });
        choiceGridEl.appendChild(btn);
      });

      visitedCount++;
      const progressCode = String(visitedCount).padStart(3, "0");
      metaPathEl.textContent = progressCode;
      chapterProgressEl.textContent = `ipsum · ${progressCode}`;
    }

    function goToScene(id) {
      currentSceneId = id;
      const scene = getScene(id);
      editMetaStatus(scene);
      updateTimelineActive(id);
      renderScene(scene);
    }

    function editMetaStatus(scene) {
      const metaStatusEl = document.getElementById("metaStatus");
      if (scene.id === "s06") {
        metaStatusEl.textContent = "finis";
      } else if (visitedCount > 6) {
        metaStatusEl.textContent = "mutatio";
      } else {
        metaStatusEl.textContent = "incipit";
      }
    }

    // --- HERO SHEET INTERACTIONS --------------------------------------------

    const heroNameInput = document.getElementById("heroName");
    const heroRoleSelect = document.getElementById("heroRole");
    const heroTraitInput = document.getElementById("heroTrait");
    const heroCodeInput = document.getElementById("heroCode");
    const heroNotesInput = document.getElementById("heroNotes");
    const avatarNamePreviewEl = document.getElementById("avatarNamePreview");
    const avatarTagsEl = document.getElementById("avatarTags");
    const avatarInput = document.getElementById("avatarInput");
    const avatarImg = document.getElementById("avatarImg");
    const avatarLabel = document.getElementById("avatarLabel");

    function updateAvatarName() {
      const name = heroNameInput.value.trim() || "lorem ipsum";
      avatarNamePreviewEl.textContent = name;
    }

    function updateAvatarTags() {
      const role = heroRoleSelect.value || "umbra";
      const trait = heroTraitInput.value.trim() || "dolor";
      const code = heroCodeInput.value.trim() || "ipsum-000";

      avatarTagsEl.innerHTML = "";

      const tags = [role, trait, code].filter(Boolean);
      tags.forEach((tag) => {
        const span = document.createElement("span");
        span.className = "avatar-tag";
        span.textContent = tag;
        avatarTagsEl.appendChild(span);
      });
    }

    heroNameInput.addEventListener("input", updateAvatarName);
    heroRoleSelect.addEventListener("change", updateAvatarTags);
    heroTraitInput.addEventListener("input", updateAvatarTags);
    heroCodeInput.addEventListener("input", updateAvatarTags);

    avatarInput.addEventListener("change", (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (event) => {
        avatarImg.src = event.target.result;
        avatarImg.style.display = "block";
        avatarLabel.style.display = "none";
      };
      reader.readAsDataURL(file);
    });

    // --- EXPORT --------------------------------------------------------------

    function collectHeroData() {
      return {
        nomen: heroNameInput.value.trim() || "lorem ipsum",
        persona: heroRoleSelect.value || "umbra",
        signum: heroTraitInput.value.trim() || "dolor",
        codex: heroCodeInput.value.trim() || "ipsum-000",
        lorem: heroNotesInput.value.trim() || "ipsum dolor sit amet...",
        scena: currentSceneId,
        iter: visitedCount
      };
    }

    function downloadFile(filename, content) {
      const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    document.getElementById("exportJsonBtn").addEventListener("click", () => {
      const hero = collectHeroData();
      const json = JSON.stringify(hero, null, 2);
      downloadFile("lorem3-persona.json", json);
    });

    document.getElementById("exportTxtBtn").addEventListener("click", () => {
      const hero = collectHeroData();
      const txt =
        "LOREM 3 PERSONA\n\n" +
        "nomen: " + hero.nomen + "\n" +
        "persona: " + hero.persona + "\n" +
        "signum: " + hero.signum + "\n" +
        "codex: " + hero.codex + "\n" +
        "lorem: " + hero.lorem + "\n" +
        "scena: " + hero.scena + "\n" +
        "iter: " + hero.iter + "\n" +
        "<ipsum>ipsum</ipsum>\n";
      downloadFile("lorem3-persona.txt", txt);
    });

    // --- INIT ----------------------------------------------------------------

    buildTimeline();
    goToScene(currentSceneId);
    updateAvatarName();
    updateAvatarTags();
  </script>
</body>
</html>
